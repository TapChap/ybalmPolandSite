<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery</title>
    <!-- toggle comment for local development-->
    <base href="https://tapchap.github.io/ybalmPolandSite/">
<!--    <base href="/">-->
    <link rel="stylesheet" href="style.css">
</head>

<body>
<header>
    <h1>Image Gallery</h1>

    <img src="resources/ybalm.png" alt="Corner Image 1" class="corner-images top-left">
    <img src="resources/BAnetwork.png" alt="Corner Image 2" class="corner-images top-right">
</header>

<nav>
    <a href="index.html">ראשי</a>
    <a href="pages/gallery.html">גלריית התמונות</a>
    <a href="pages/dailySummary.html">סיכום יומי</a>
    <a href="pages/letterToPoland.html">מכתב לפולין</a>
</nav>

<script type="module" src="https://cdn.jsdelivr.net/npm/ldrs/dist/auto/zoomies.js"></script>

<div class="gallery" id="gallery">
    <l-zoomies size="150" speed="1.6" bg-opacity="0.15" stroke="5" color="black" id="loading" style="margin-top: 120px"></l-zoomies>
<!--    <iframe id="loading" src="https://giphy.com/embed/sSgvbe1m3n93G" width="80" height="80" style="" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>-->
</div>

<script type="module">
    import {initializeApp} from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import {getStorage, ref, listAll, getDownloadURL} from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBtFxfJfWYzTkjCMrhySoPofAS5zAbmqKM",
        authDomain: "ybalmpolandsite.firebaseapp.com",
        projectId: "ybalmpolandsite",
        storageBucket: "ybalmpolandsite.appspot.com",
        messagingSenderId: "581656278199",
        appId: "1:581656278199:web:d43566dcc3a87093c50932",
        measurementId: "G-Z8HQTJMV7V"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);

    const gallery = document.getElementById('gallery');

    async function loadImages() {
        for (let i = 10; i >= 0; i--) {
            const storageRef = ref(storage, `day${i}`);
            const listResult = await listAll(storageRef);
            const downloadPromises = listResult.items.map(itemRef => getDownloadURL(itemRef));
            const urls = await Promise.all(downloadPromises);

            if (listResult.items.length > 0) {

                const hr = document.createElement("hr");
                const dayNum = document.createElement("h2");
                dayNum.textContent = `Day ${i}`;
                gallery.appendChild(hr);
                gallery.appendChild(dayNum);

                const dayBox = document.createElement("div");
                dayBox.className = 'day-box';

                for (const url of urls) {
                    const img = document.createElement('img');
                    img.src = url;
                    dayBox.appendChild(img);
                }

                gallery.appendChild(dayBox);
            }
        }
    }

    function makeImagesVisible() {
        const elements = document.querySelectorAll('gallery');
        elements.forEach(element => {
            element.style.visibility = 'visible';
        });
    }

    await loadImages();
    await document.getElementById("loading").remove();
    makeImagesVisible();


</script>
</body>

</html>