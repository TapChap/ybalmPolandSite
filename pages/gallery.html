<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery</title>
    <base href="https://tapchap.github.io/ybalmPolandSite/">
    <link rel="stylesheet" href="/ybalmPolandSite/style.css">
</head>

<body>
<header>
    <h1>Image Gallery</h1>

    <img src="/ybalmPolandSite/resources/ybalm.png" alt="Corner Image 1" class="corner-images top-left">
    <img src="/ybalmPolandSite/resources/BAnetwork.png" alt="Corner Image 2" class="corner-images top-right">
</header>

<nav>
    <a href="/ybalmPolandSite/index.html">ראשי</a>
    <a href="/ybalmPolandSite/pages/gallery.html">גלריית התמונות</a>
    <a href="/ybalmPolandSite/pages/dailySummary.html">סיכום יומי</a>
    <a href="/ybalmPolandSite/pages/letterToPoland.html">מכתב לפולין</a>
</nav>

<div class="gallery" id="gallery">
    <iframe id="loading" src="https://giphy.com/embed/sSgvbe1m3n93G" width="80" height="80" style="" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
</div>

<script type="module">
    // Import the functions you need from the SDKs you need
    import {initializeApp} from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import {
        getStorage,
        ref,
        listAll,
        getDownloadURL
    } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBtFxfJfWYzTkjCMrhySoPofAS5zAbmqKM",
        authDomain: "ybalmpolandsite.firebaseapp.com",
        projectId: "ybalmpolandsite",
        storageBucket: "ybalmpolandsite.appspot.com",
        messagingSenderId: "581656278199",
        appId: "1:581656278199:web:d43566dcc3a87093c50932",
        measurementId: "G-Z8HQTJMV7V"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);

    const gallery = document.getElementById('gallery');

    async function loadImages() {
        for (let i = 10; i >= 0; i--) {
            const storageRef = ref(storage, `day${i}`);
            const listResult = await listAll(storageRef);
            const downloadPromises = listResult.items.map(itemRef => getDownloadURL(itemRef));
            const urls = await Promise.all(downloadPromises);

            if (listResult.items.length > 0) {

                const hr = document.createElement("hr");
                const dayNum = document.createElement("h2");
                dayNum.textContent = `Day ${i}`;
                gallery.appendChild(hr);
                gallery.appendChild(dayNum);

                const dayBox = document.createElement("div");
                dayBox.className = 'day-box';

                for (const url of urls) {
                    const img = document.createElement('img');
                    img.src = url;
                    dayBox.appendChild(img);
                }

                gallery.appendChild(dayBox);
            }
        }
    }

    await loadImages();
    document.getElementById("loading").remove();

</script>
</body>

</html>